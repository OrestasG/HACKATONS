<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ignitis – nepriklausomo tiekėjo elektros kelias ⚡</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(180deg, #fffbea, #e0f7fa);
      color: #023047;
      margin: 0;
      text-align: center;
    }

    h1 {
      color: #0077b6;
      margin-top: 20px;
    }

    /* --- SVG kelias --- */
    #roadmap {
      width: 100%;
      max-width: 1200px;
      height: 450px;
      margin: 30px auto;
      position: relative;
    }

    svg {
      width: 100%;
      height: 100%;
      overflow: visible;
    }

    #pathBackground {
      stroke: #ccc;
      stroke-width: 10;
      fill: none;
      stroke-linecap: round;
    }

    #pathActive {
      stroke: #ffd166;
      stroke-width: 10;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;
      transition: stroke-dashoffset 1s ease;
    }

    .stage {
      cursor: pointer;
      transition: filter 0.15s ease;
    }

    .stage:hover {
      filter: brightness(1.12);
    }

    .icon {
      font-size: 34px;
      text-anchor: middle;
      dominant-baseline: middle;
    }

    .icon-label {
      font-size: 14px;
      text-anchor: middle;
      fill: #023047;
      font-weight: 600;
    }

    .cost-label {
      font-size: 12px;
      text-anchor: middle;
      fill: #0077b6;
      font-weight: 600;
      transform: translateY(55px);
    }

    /* --- Valdikliai --- */
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin-top: 15px;
    }

    select, input[type=range], input[type=number] {
      border-radius: 8px;
      padding: 6px 10px;
      font-size: 14px;
    }

    .total {
      font-weight: 700;
      color: #0077b6;
      margin: 12px 0;
    }

    /* --- Skaičiuoklės boxas --- */
    .calc-box {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
      max-width: 1100px;
      margin: 20px auto;
      padding: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }

    th, td {
      padding: 8px;
      border-bottom: 1px dashed #eee;
      text-align: left;
    }

    th {
      background: #caf0f8;
      color: #023047;
    }

    .total-row td {
      font-weight: 700;
      color: #0077b6;
    }

    canvas#chart {
      max-height: 240px;
      margin-top: 16px;
    }

    /* 🔹 Atsakas mobiliesiems */
    @media (max-width: 600px) {
      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      select, input[type=range], input[type=number] {
        width: 100%;
      }
    }

    /* --- Modal stiliai --- */
    .overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .popup {
      background: white;
      border-radius: 16px;
      padding: 24px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      animation: fadeIn 0.3s ease;
      text-align: left;
      position: relative;
    }

    .popup h2 {
      color: #0077b6;
      margin-top: 0;
    }

    .popup p {
      font-size: 15px;
      color: #023047;
      margin-bottom: 15px;
    }

    .close {
      position: absolute;
      top: 12px;
      right: 16px;
      font-size: 26px;
      color: #0077b6;
      cursor: pointer;
    }

    @keyframes fadeIn {
      from { transform: translateY(-10px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
  </style>
</head>
<body>
  <h1>⚡ Nepriklausomo tiekėjo elektros kelias ⚡</h1>

  <div id="roadmap">
    <svg viewBox="0 0 1200 400">
      <path id="pathBackground" d="M 80 330 C 200 150, 400 150, 1060 230" />
      <path id="pathActive" d="M 80 330 C 200 150, 400 150, 1060 230" />

      <g class="stage" data-step="1" data-info="Čia prasideda elektros kelionė – elektrinės gamina energiją iš įvairių šaltinių (vėjo, saulės, biokuro ar dujų)." data-video="https://www.youtube.com/embed/Ff0uZl5azF4" transform="translate(80,330)">
        <text class="icon">🏭</text>
        <text class="icon-label" y="38">Gamyba</text>
        <text class="cost-label" y="40" id="cost1">–</text>
      </g>

      <g class="stage" data-step="2" data-info="Elektros energija perkama biržoje – jos kaina priklauso nuo paklausos ir pasiūlos." data-video="https://www.youtube.com/embed/ZUZ9PZUm14k" transform="translate(290,197)">
        <text class="icon">📈</text>
        <text class="icon-label" y="38">Rinka</text>
        <text class="cost-label" y="40" id="cost2">–</text>
      </g>

      <g class="stage" data-step="3" data-info="Energija perduodama aukštos įtampos tinklais iš gamintojų į regioninius paskirstymo centrus." data-video="https://www.youtube.com/embed/1A5wfd0ZFbE" transform="translate(485,185)">
        <text class="icon">🔌</text>
        <text class="icon-label" y="38">Perdavimas</text>
        <text class="cost-label" y="40" id="cost3">–</text>
      </g>

      <g class="stage" data-step="4" data-info="Elektros tinklai paskirsto energiją iki jūsų namų – tai didžiausia infrastruktūros dalis." data-video="https://www.youtube.com/embed/Z8dG0oC6QjY" transform="translate(700,195)">
        <text class="icon">🛣️</text>
        <text class="icon-label" y="38">Skirstymas</text>
        <text class="cost-label" y="40" id="cost4">–</text>
      </g>

      <g class="stage" data-step="5" data-info="Balansavimo sistema užtikrina, kad visada būtų tiek elektros, kiek jos reikia – nei per daug, nei per mažai." data-video="https://www.youtube.com/embed/9xB0-YgD5oU" transform="translate(910,215)">
        <text class="icon">⚖️</text>
        <text class="icon-label" y="38">Balansavimas</text>
        <text class="cost-label" y="40" id="cost5">–</text>
      </g>

      <g class="stage" data-step="6" data-info="Galiausiai elektra pasiekia jūsų namus – ją naudojate apšvietimui, buitinei technikai ir visiems kasdieniams poreikiams." data-video="https://www.youtube.com/embed/m-0xR7u9vVA" transform="translate(1060,230)">
        <text class="icon">🏠</text>
        <text class="icon-label" y="38">Namai</text>
        <text class="cost-label" y="40" id="cost6">–</text>
      </g>
    </svg>
  </div>

  <!-- 🔹 Modal langas -->
  <div id="popupOverlay" class="overlay">
    <div class="popup">
      <span class="close">&times;</span>
      <h2 id="popupTitle"></h2>
      <p id="popupText"></p>
      <div id="popupVideoContainer">
        <iframe id="popupVideo" width="100%" height="315" frameborder="0" allowfullscreen></iframe>
      </div>
    </div>
  </div>

  <div class="info-box">
	  <h2>🏙️ Vilniaus elektros vartojimo apžvalga</h2>
	    <p>⚡ Vidutinis butas: apie <strong>1700–2000 kWh per metus</strong></p>
	    <p>🏡 Namai su elektriniu šildymu: iki <strong>10 000 kWh</strong></p>
	    <p>💶 Vidutinės išlaidos: apie <strong>300–600 € per metus</strong></p>
	    <p>🌿 Žalios energijos dalis: <strong>~37 %</strong></p>
	  <p class="small">
	    Tai rodo, kad dauguma vilniečių jau yra ekonomiški vartotojai.
	    Didžiausią įtaką kainai turi pasirinktas planas ir paros laikas.
	  </p>
	</div>

  <div class="info-box">
      <h2>👣 Kaip pereiti prie nepriklausomo tiekėjo</h2>
        <p>Peržiūrėkite pasiūlymus iš kelių tiekėjų.</p>
        <p>Pasirinkite planą pagal savo suvartojimą (žr. skaičiuoklę).</p>
        <p>Sudarykite sutartį internetu ar telefonu – jokių techninių darbų nereikia.</p>
        <p>Gausite sąskaitą jau iš naujojo tiekėjo, tačiau elektra bus ta pati.</p>
      <p class="small">Jei nieko nedarysite – elektra liks tiekiama visuomeniniu tarifu (brangesniu).</p>
  </div>
  
  <div class="calc-box">
    <h3>🔢 Kainos skaičiuoklė</h3>
    <div class="controls">
      <label>Tiekėjas:</label>
      <select id="supplierSelect">
        <option value="ignitis">Ignitis</option>
        <option value="enefit">Enefit</option>
        <option value="elektrum">Elektrum</option>
      </select>
      <label>Planas:</label>
      <select id="planSelect">
        <option value="fiksuotas">Fiksuotas</option>
        <option value="rinkos">Kintamas (biržos)</option>
      </select>
      <label>Kiekis (kWh):</label>
      <input id="kwhRange" type="range" min="1" max="1000" value="100" step="1" />
      <input id="kwhInput" type="number" min="1" max="1000" value="100" step="1" style="width:80px" /> kWh
    </div>
    <p class="total">Bendra kaina: <span id="totalCost">0.00 €</span></p>
    <table>
      <thead><tr><th>Etapas / komponentas</th><th>Kaina (EUR)</th></tr></thead>
      <tbody id="costTable"></tbody>
      <tfoot><tr class="total-row"><td>Iš viso (su PVM)</td><td id="sumTotal">– €</td></tr></tfoot>
    </table>
    <canvas id="chart"></canvas>
    <p id="recommendation" style="font-weight:700; color:#0077b6; margin-top:15px;"></p>
  </div>

  <script>
    const path = document.getElementById("pathActive");
    const totalLength = path.getTotalLength();
    path.style.strokeDasharray = totalLength;
    path.style.strokeDashoffset = totalLength;
    const stages = document.querySelectorAll(".stage");
    const stagePositions = [80, 280, 480, 700, 900, 1060];

    function animatePathToX(xTarget, step) {
      if (step === stagePositions.length) {
        path.style.strokeDashoffset = 0;
        return;
      }
      let found = 0;
      for (let i = 0; i <= totalLength; i += 5) {
        const point = path.getPointAtLength(i);
        if (point.x >= xTarget) {
          found = i;
          break;
        }
      }
      const percent = found / totalLength;
      const offset = totalLength * (1 - percent);
      path.style.strokeDashoffset = offset;
    }

    stages.forEach(stage => {
      stage.addEventListener("click", () => {
        const step = parseInt(stage.dataset.step);
        animatePathToX(stagePositions[step - 1], step);
      });
    });

    const supplierSelect = document.getElementById("supplierSelect");
    const planSelect = document.getElementById("planSelect");
    const kwhRange = document.getElementById("kwhRange");
    const kwhInput = document.getElementById("kwhInput");
    const costTable = document.getElementById("costTable");
    const sumTotal = document.getElementById("sumTotal");
    const totalCost = document.getElementById("totalCost");
    const VAT = 0.21;

    const regulated = { transmission: 0.0011, distribution: 0.0315, balancing: 0.0121, metering: 0.0024 };
    const supplierRates = { ignitis: { fiksuotas: 0.175, rinkos: 0.160 }, enefit: { fiksuotas: 0.179, rinkos: 0.164 }, elektrum: { fiksuotas: 0.181, rinkos: 0.167 } };

    function updateCosts() {
      const supplier = supplierSelect.value;
      const plan = planSelect.value;
      const rate = supplierRates[supplier][plan];
      const kwh = +kwhRange.value;
      kwhInput.value = kwh;
      const regulatedSum = Object.values(regulated).reduce((a, b) => a + b, 0);
      const energyPart = Math.max(0, rate - regulatedSum);
      const gen = energyPart * 0.7;
      const supp = energyPart * 0.3;
      const rows = [
        { key: "Energijos gamyba", val: gen * kwh },
        { key: "Perdavimas", val: regulated.transmission * kwh },
        { key: "Skirstymas", val: regulated.distribution * kwh },
        { key: "Balansavimas", val: regulated.balancing * kwh },
        { key: "Tiekėjo paslaugos", val: supp * kwh },
        { key: "Skaitikliai / duomenys", val: regulated.metering * kwh }
      ];
      const net = rows.reduce((a, b) => a + b.val, 0);
      const vat = net * VAT;
      const total = net + vat;
      costTable.innerHTML = rows.map(r => `<tr><td>${r.key}</td><td>${r.val.toFixed(4)} €</td></tr>`).join("") + `<tr><td>PVM (21%)</td><td>${vat.toFixed(4)} €</td></tr>`;
      sumTotal.textContent = total.toFixed(4) + " €";
      totalCost.textContent = total.toFixed(2) + " €";
      drawChart(rows.concat([{ label: "PVM", value: vat }]));
      updateStageLabels(rate, kwh);
      suggestPlan(kwh);
    }

    function suggestPlan(kwh) {
      let text = "";
      if (kwh < 500) text = "Pagal Jūsų suvartojimą, labiausiai apsimoka „Ignitis“ – rinkos planas (biržos kaina).";
      else if (kwh < 800) text = "Pagal Jūsų suvartojimą, geriausias pasirinkimas – „Ignitis“ – fiksuotas planas.";
      else if (kwh < 1200) text = "Pagal Jūsų suvartojimą, apsimoka „Enefit“ – kintamas (rinkos) planas.";
      else text = "Pagal Jūsų suvartojimą, geriausias pasirinkimas – „Elektrum“ – fiksuotas planas.";
      document.getElementById("recommendation").textContent = text;
    }

    let chart;
    function drawChart(rows) {
      const ctx = document.getElementById("chart").getContext("2d");
      const labels = rows.map(r => r.key || r.label);
      const data = rows.map(r => r.val || r.value);
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "doughnut",
        data: { labels, datasets: [{ data }] },
        options: { plugins: { legend: { position: "bottom" } } }
      });
    }

    function updateStageLabels(rate, kwh) {
      document.getElementById("cost1").textContent = (rate * 0.7 * kwh).toFixed(2) + " €";
      document.getElementById("cost2").textContent = (regulated.transmission * kwh).toFixed(2) + " €";
      document.getElementById("cost3").textContent = (regulated.distribution * kwh).toFixed(2) + " €";
      document.getElementById("cost4").textContent = (regulated.balancing * kwh).toFixed(2) + " €";
      document.getElementById("cost5").textContent = (regulated.metering * kwh).toFixed(2) + " €";
      document.getElementById("cost6").textContent = "–";
    }

    [supplierSelect, planSelect, kwhRange, kwhInput].forEach(el => el.addEventListener("input", updateCosts));
    updateCosts();

    /* --- Modal logika --- */
    const overlay = document.getElementById("popupOverlay");
    const popupTitle = document.getElementById("popupTitle");
    const popupText = document.getElementById("popupText");
    const popupVideo = document.getElementById("popupVideo");
    const closeBtn = document.querySelector(".close");

    stages.forEach(stage => {
      stage.addEventListener("dblclick", () => {
        popupTitle.textContent = stage.querySelector(".icon-label").textContent;
        popupText.textContent = stage.dataset.info;
        popupVideo.src = stage.dataset.video;
        overlay.style.display = "flex";
      });
    });

    closeBtn.onclick = () => {
      overlay.style.display = "none";
      popupVideo.src = "";
    };

    window.onclick = e => {
      if (e.target === overlay) {
        overlay.style.display = "none";
        popupVideo.src = "";
      }
    };
  </script>
</body>
</html>
